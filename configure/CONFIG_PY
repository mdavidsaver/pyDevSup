ifneq ($(T_A),)

PYMODULE ?= YES

ifeq ($(PYTHON),)
$(error Must set PYTHON to select a python version)
endif

-include $(dir $(lastword $(MAKEFILE_LIST)))/os/CONFIG_PY.$(EPICS_HOST_ARCH).Common
-include $(dir $(lastword $(MAKEFILE_LIST)))/os/CONFIG_PY.Common.$(T_A)
-include $(dir $(lastword $(MAKEFILE_LIST)))/os/CONFIG_PY.$(EPICS_HOST_ARCH).$(T_A)

-include $(dir $(lastword $(MAKEFILE_LIST)))/os/CONFIG_SITE_PY.$(EPICS_HOST_ARCH).Common
-include $(dir $(lastword $(MAKEFILE_LIST)))/os/CONFIG_SITE_PY.Common.$(T_A)
-include $(dir $(lastword $(MAKEFILE_LIST)))/os/CONFIG_SITE_PY.$(EPICS_HOST_ARCH).$(T_A)

ifneq ($(PY_OK),YES)
$(error No usable configuration for $(PYTHON))
endif

SHRLIB_DEPLIB_DIRS += $(PY_LIBDIRS)
PROD_DEPLIB_DIRS += $(PY_LIBDIRS)

$(info $$PY_INCDIRS is ${PY_INCDIRS})

ifeq (windows-x64, $(findstring windows-x64, $(T_A)))
    INCLUDES += -IC:/Python310/lib/site-packages/numpy/core/include
    INCLUDES += -IC:/Python310/include
else
    INCLUDES += $(PY_INCDIRS:%=-I%)
endif

$(info $$INCLUDES is ${INCLUDES})

ifeq ($(HAVE_NUMPY),YES)
TARGET_CPPFLAGS += -DHAVE_NUMPY
else
$(error numpy required)
endif

#LIB_SYS_LIBS += python$(PY_LD_VER)
#PROD_SYS_LIBS += python$(PY_LD_VER)

PY_INSTALL_DIR = $(INSTALL_LOCATION)/python$(PY_LD_VER)/$(T_A)
$(info $$PY_INSTALL_DIR is ${PY_INSTALL_DIR})

ifneq ($(PYMODULE),NO)

# Python loadables have no prefix (eg 'pymod.so')
# and are installed alongsize .py files
LOADABLE_SHRLIB_PREFIX =

INSTALL_SHRLIB = $(PY_INSTALL_DIR)

ifeq ($(OS_CLASS),Darwin)
# need -undefined dynamic_lookup
LOADABLE_SHRLIB_LDFLAGS = -bundle -flat_namespace -undefined dynamic_lookup
LOADABLE_SHRLIB_SUFFIX = .so
endif

endif

endif
